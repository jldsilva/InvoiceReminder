# This workflow will build and test a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: .NET CI Workflow

permissions:
  contents: read

on:
  pull_request:
    branches: [ "main", "develop" ]
  push:
    branches: [ "main", "develop" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x

    - name: Restore Dependencies
      run: dotnet restore

    - name: Build
      run: dotnet build --no-restore --configuration Debug --nologo

    - name: Run Tests
      shell: bash
      run: |
        echo "üîç Localizando Projetos de Teste..."
        TEST_PROJECTS=$(find . -name "*.csproj" | grep -E "\.UnitTests|\.Tests" | grep -v "Assets")

        if [ -z "$TEST_PROJECTS" ]; then
          echo "‚ö†Ô∏è Nenhum projeto de teste encontrado."
          exit 1
        fi

        FAIL=0
        for PROJ in $TEST_PROJECTS; do
          echo "::group::üöÄ Testando $PROJ"
          dotnet test --project "$PROJ" --no-build --configuration Debug --verbosity normal || FAIL=1
          echo "::endgroup::"
        done

        if [ $FAIL -ne 0 ]; then
          echo "‚ùå Alguns testes falharam."
          exit 1
        fi
        
        echo "‚úÖ Todos os testes passaram!"
